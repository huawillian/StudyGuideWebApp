<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-toolbar/paper-toolbar.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/paper-drawer-panel/paper-drawer-panel.html">
<link rel="import" href="../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../bower_components/polymer-quill/polymer-quill.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/app-route/app-location.html">
<link rel="import" href="../../bower_components/app-route/app-route.html">
<link rel="import" href="../../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../../bower_components/polymerfire/firebase-app.html">
<link rel="import" href="../../bower_components/polymerfire/firebase-document.html">


<dom-module id="StudyGuideWebApp-app">
  <template>
    <style>
      :host {
        display: block;
      }

      paper-item {
        margin: 0;
        padding: 5%;
        width: 90%;
        height: 50px;
        font-size: 20px;
        background-color: rgba(200,200,200,0.2);
      }

      #menu-header {
        height: 70px;
        font-size: 30px;
        margin: 0;
        padding: 5%;
        width: 90%;
        background-color: rgba(255,255,255,0.5);
      }

      #menu {
        background-color: rgb(200,200,200);
        height:100vh;
      }

    </style>

    <firebase-app auth-domain="studyguidemvp.firebaseapp.com"
      database-url="https://studyguidemvp.firebaseio.com/"
      api-key="AIzaSyCriXr4uO-J76FyNxQlX_pPdO9wLjbzomo">
    </firebase-app>

    <firebase-document
      path="/guides"
      data="{{noteData}}">
    </firebase-document>


    <app-location route="{{route}}"></app-location>
    <app-route
        route="{{route}}"
        pattern="/:page/:section"
        data="{{routeData}}"
        tail="{{tail}}">
    </app-route>

    <paper-drawer-panel>

      <paper-header-panel drawer>
        <div id='menu'>
          <div id="menu-header"> Sections </div>
          <template is="dom-repeat" items="{{sections}}">
              <paper-item> {{item.sectionname}} </paper-item>
          </template>
        </div>
      </paper-header-panel>

      <paper-header-panel main>
        <paper-toolbar>
          <paper-icon-button icon="menu" paper-drawer-toggle></paper-icon-button>
          <div> Study Guide Name </div>
        </paper-toolbar>


        <!-- iron-pages selects the view based on the active route -->
        <iron-pages selected="[[routeData.page]]" attr-for-selected="name" fallback-selection="invalidPage">
          <div name='section'> Hi going to show data for {{routeData.section}} </div>
        </iron-pages>







        <template is="dom-if" if="{{isEditing}}">
          <br>
          <div> Editing... </div>
          <br>
          <polymer-quill
            content='{"ops":[{"insert":"Hello World! - Store as Delta"},{"attributes":{"header":2},"insert":"\n"}]}'
            class="full"
            store-as="html"
            save-interval="1000"
            toolbar-type="full"
            on-change="handleQuillChange">
          </polymer-quill>
          <br>
          <paper-button raised on-click='changeDisplay'> Save Changes </paper-button>
          <paper-button raised> Cancel Changes </paper-button>
          <br>
        </template>

        <div id="resultDom">
          {{prop1}}
        </div>

        <div>{{noteData}}</div>

      </paper-header-panel>

    </paper-drawer-panel>



  </template>

  <script>
    Polymer({

      is: 'StudyGuideWebApp-app',

      properties: {
        prop1: {
          type: String,
          value: 'StudyGuideWebApp-app',
        },
        isEditing: {
          type: Boolean,
          value: true
        },
        noteData: {
          type: String,
          value: '',
          observer: 'onNoteDataChange'
        },
        sections: {
          type: Array,
          value: []
        },
        guide: {
          type: String,
          value: 'Example Guide'
        }
      },

      ready: function(){
        this.listen(this.$.menu, 'click', 'setSectionPage');
      },

      handleQuillChange: function(e) {
        this.prop1 = e.detail.content;
      },

      changeDisplay: function(e) {
        this.isEditing = false;
        this.$.resultDom.innerHTML = this.prop1;
      },

      onNoteDataChange: function(newVal){
        console.log(newVal);
        if(!Array.isArray(newVal)) return;

        this.set('pageData', newVal.find((obj) => obj.guidename == this.guide));
        this.set('sections', this.pageData.sections);

        console.log(this.pageData, this.sections, this.routeData);
      },

      setSectionPage: function(e){
        console.log(e.target.innerText, this.route);
        this.set('route.path', '/content/' + e.target.innerText);
      }

    });
  </script>
</dom-module>
